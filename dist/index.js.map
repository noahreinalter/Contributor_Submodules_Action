{"version":3,"file":"index.js","names":["__webpack_require__","ab","URL","url","pathname","slice","match","__awaiter","undefined","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","core_1","require","exec_1","fs_1","run","this","getInput","path","exec","addSubmodule","reloadAllSubmodules","error","Error","setFailed","message","splitUrl","split","username","length","fileNames","readdirSync","debug","toString","regex","RegExp","file","test","addLink","submoduleNames","submoduleName","targedName","existsSync","mkdirSync"],"sources":["../webpack/runtime/compat","../lib/main.js"],"sourcesContent":["\nif (typeof __webpack_require__ !== 'undefined') __webpack_require__.ab = new URL('.', import.meta.url).pathname.slice(import.meta.url.match(/^file:\\/\\/\\/\\w:/) ? 1 : 0, -1) + \"/\";","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst core_1 = require(\"@actions/core\");\nconst exec_1 = require(\"@actions/exec\");\nconst fs_1 = require(\"fs\");\nfunction run() {\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            const url = (0, core_1.getInput)('url');\n            const path = (0, core_1.getInput)('submodule_save_location');\n            if ((0, core_1.getInput)('update_submodules') === 'true') {\n                yield (0, exec_1.exec)('git submodule update --remote');\n            }\n            if (url != null && url.match(/^https:\\/\\/.*\\.git$/)) {\n                yield addSubmodule(url, path);\n            }\n            if ((0, core_1.getInput)('relink_submodules') === 'true') {\n                reloadAllSubmodules(path);\n            }\n        }\n        catch (error) {\n            if (error instanceof Error)\n                (0, core_1.setFailed)(error.message);\n        }\n    });\n}\nfunction addSubmodule(url, path) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const splitUrl = url.split('/');\n        const username = splitUrl[splitUrl.length - 2];\n        yield (0, exec_1.exec)(`git submodule add ${url} ${path}/${username}`);\n        const fileNames = (0, fs_1.readdirSync)(`./${path}/${username}`);\n        (0, core_1.debug)(`There are ${fileNames.length.toString()} files in the new submodule`);\n        const regex = RegExp((0, core_1.getInput)('regex'));\n        for (const file of fileNames) {\n            if (regex.test(file)) {\n                (0, core_1.debug)(`Add link for file ${file}`);\n                addLink(file, username, path);\n            }\n        }\n    });\n}\nfunction reloadAllSubmodules(path) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const submoduleNames = (0, fs_1.readdirSync)(`./${path}`);\n        for (const submoduleName of submoduleNames) {\n            const fileNames = (0, fs_1.readdirSync)(`./${path}/${submoduleName}`);\n            const regex = RegExp((0, core_1.getInput)('regex'));\n            for (const file of fileNames) {\n                if (regex.test(file)) {\n                    addLink(file, submoduleName, path);\n                }\n            }\n        }\n    });\n}\nfunction addLink(targedName, username, path) {\n    return __awaiter(this, void 0, void 0, function* () {\n        (0, core_1.debug)(`Add ${targedName} for ${username} if necessary`);\n        if (!(0, fs_1.existsSync)(targedName)) {\n            (0, core_1.debug)(`Create dir ${targedName}`);\n            (0, fs_1.mkdirSync)(targedName);\n        }\n        yield (0, exec_1.exec)(`ln -s ../${path}/${username}/${targedName} ./${targedName}/${username}`);\n    });\n}\nrun();\n"],"mappings":"AACA,UAAAA,sBAAA,YAAAA,oBAAAC,GAAA,IAAAC,IAAA,gBAAAC,KAAAC,SAAAC,kBAAAF,IAAAG,MAAA,+B,SCAA,IAAAC,EAAAC,qBAAAD,WAAA,SAAAE,EAAAC,EAAAC,EAAAC,GACA,SAAAC,MAAAC,GAAA,OAAAA,aAAAH,EAAAG,EAAA,IAAAH,GAAA,SAAAI,KAAAD,EAAA,IACA,WAAAH,MAAAK,WAAA,SAAAD,EAAAE,GACA,SAAAC,UAAAJ,GAAA,IAAAK,KAAAP,EAAAQ,KAAAN,GAAA,OAAAO,GAAAJ,EAAAI,EAAA,EACA,SAAAC,SAAAR,GAAA,IAAAK,KAAAP,EAAA,SAAAE,GAAA,OAAAO,GAAAJ,EAAAI,EAAA,EACA,SAAAF,KAAAI,KAAAC,KAAAT,EAAAQ,EAAAT,OAAAD,MAAAU,EAAAT,OAAAW,KAAAP,UAAAI,SAAA,CACAH,MAAAP,IAAAc,MAAAjB,EAAAC,GAAA,KAAAU,OACA,GACA,EACAO,OAAAC,eAAAC,QAAA,cAAAf,MAAA,OACA,MAAAgB,EAAAC,QAAA,iBACA,MAAAC,EAAAD,QAAA,iBACA,MAAAE,EAAAF,QAAA,MACA,SAAAG,MACA,OAAA3B,EAAA4B,UAAA,sBACA,IACA,MAAAhC,GAAA,EAAA2B,EAAAM,UAAA,OACA,MAAAC,GAAA,EAAAP,EAAAM,UAAA,2BACA,MAAAN,EAAAM,UAAA,qCACA,EAAAJ,EAAAM,MAAA,gCACA,CACA,GAAAnC,GAAA,MAAAA,EAAAG,MAAA,8BACAiC,aAAApC,EAAAkC,EACA,CACA,MAAAP,EAAAM,UAAA,+BACAI,oBAAAH,EACA,CACA,CACA,MAAAI,GACA,GAAAA,aAAAC,OACA,EAAAZ,EAAAa,WAAAF,EAAAG,QACA,CACA,GACA,CACA,SAAAL,aAAApC,EAAAkC,GACA,OAAA9B,EAAA4B,UAAA,sBACA,MAAAU,EAAA1C,EAAA2C,MAAA,KACA,MAAAC,EAAAF,IAAAG,OAAA,SACA,EAAAhB,EAAAM,MAAA,qBAAAnC,KAAAkC,KAAAU,KACA,MAAAE,GAAA,EAAAhB,EAAAiB,aAAA,KAAAb,KAAAU,MACA,EAAAjB,EAAAqB,OAAA,aAAAF,EAAAD,OAAAI,yCACA,MAAAC,EAAAC,QAAA,EAAAxB,EAAAM,UAAA,UACA,UAAAmB,KAAAN,EAAA,CACA,GAAAI,EAAAG,KAAAD,GAAA,EACA,EAAAzB,EAAAqB,OAAA,qBAAAI,KACAE,QAAAF,EAAAR,EAAAV,EACA,CACA,CACA,GACA,CACA,SAAAG,oBAAAH,GACA,OAAA9B,EAAA4B,UAAA,sBACA,MAAAuB,GAAA,EAAAzB,EAAAiB,aAAA,KAAAb,KACA,UAAAsB,KAAAD,EAAA,CACA,MAAAT,GAAA,EAAAhB,EAAAiB,aAAA,KAAAb,KAAAsB,KACA,MAAAN,EAAAC,QAAA,EAAAxB,EAAAM,UAAA,UACA,UAAAmB,KAAAN,EAAA,CACA,GAAAI,EAAAG,KAAAD,GAAA,CACAE,QAAAF,EAAAI,EAAAtB,EACA,CACA,CACA,CACA,GACA,CACA,SAAAoB,QAAAG,EAAAb,EAAAV,GACA,OAAA9B,EAAA4B,UAAA,uBACA,EAAAL,EAAAqB,OAAA,OAAAS,SAAAb,kBACA,OAAAd,EAAA4B,YAAAD,GAAA,EACA,EAAA9B,EAAAqB,OAAA,cAAAS,MACA,EAAA3B,EAAA6B,WAAAF,EACA,OACA,EAAA5B,EAAAM,MAAA,YAAAD,KAAAU,KAAAa,YAAAb,IACA,GACA,CACAb","ignoreList":[]}