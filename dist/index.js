import './sourcemap-register.cjs';if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=new URL(".",import.meta.url).pathname.slice(import.meta.url.match(/^file:\/\/\/\w:/)?1:0,-1)+"/";var e={};var t=undefined&&undefined.__awaiter||function(e,t,n,i){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(i.next(e))}catch(e){o(e)}}function rejected(e){try{step(i["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});const n=require("@actions/core");const i=require("@actions/exec");const o=require("fs");function run(){return t(this,void 0,void 0,(function*(){try{const e=(0,n.getInput)("url");const t=(0,n.getInput)("submodule_save_location");if((0,n.getInput)("update_submodules")==="true"){yield(0,i.exec)("git submodule update --remote")}if(e!=null&&e.match(/^https:\/\/.*\.git$/)){yield addSubmodule(e,t)}if((0,n.getInput)("relink_submodules")==="true"){reloadAllSubmodules(t)}}catch(e){if(e instanceof Error)(0,n.setFailed)(e.message)}}))}function addSubmodule(e,u){return t(this,void 0,void 0,(function*(){const t=e.split("/");const r=t[t.length-2];yield(0,i.exec)(`git submodule add ${e} ${u}/${r}`);const d=(0,o.readdirSync)(`./${u}/${r}`);(0,n.debug)(`There are ${d.length.toString()} files in the new submodule`);const c=RegExp((0,n.getInput)("regex"));for(const e of d){if(c.test(e)){(0,n.debug)(`Add link for file ${e}`);addLink(e,r,u)}}}))}function reloadAllSubmodules(e){return t(this,void 0,void 0,(function*(){const t=(0,o.readdirSync)(`./${e}`);for(const i of t){const t=(0,o.readdirSync)(`./${e}/${i}`);const u=RegExp((0,n.getInput)("regex"));for(const n of t){if(u.test(n)){addLink(n,i,e)}}}}))}function addLink(e,u,r){return t(this,void 0,void 0,(function*(){(0,n.debug)(`Add ${e} for ${u} if necessary`);if(!(0,o.existsSync)(e)){(0,n.debug)(`Create dir ${e}`);(0,o.mkdirSync)(e)}yield(0,i.exec)(`ln -s ../${r}/${u}/${e} ./${e}/${u}`)}))}run();
//# sourceMappingURL=index.js.map